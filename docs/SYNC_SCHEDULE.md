# üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### üîÑ **–ö–∞–Ω–∞–ª—ã (iptv-org ‚ü∑ IPTVPortal)**
- **–ß–∞—Å—Ç–æ—Ç–∞:** –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
- **–î–µ–Ω—å:** –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
- **–í—Ä–µ–º—è:** 05:00 MSK (02:00 UTC)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~20-30 –º–∏–Ω—É—Ç

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –î–∞–º–ø IPTVPortal tv_channel (7,341 –∫–∞–Ω–∞–ª–æ–≤)
2. –°–±–æ—Ä–∫–∞ iptv-org –±–∞–∑—ã (38,723 –∫–∞–Ω–∞–ª–∞)
3. Fuzzy matching (exact + fuzzy)
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
5. Commit –≤ GitHub

### üì∫ **EPG (–ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ–¥–∞—á)**
- **–ß–∞—Å—Ç–æ—Ç–∞:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ
- **–í—Ä–µ–º—è:** 03:00 MSK (00:00 UTC)
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~5-10 –º–∏–Ω—É—Ç

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ EPG –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è XML
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è M3U –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ —Å EPG
4. Commit –≤ GitHub

---

## üìä –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –¥–µ—Ç–∞–ª—è—Ö

| –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ | –í—Ä–µ–º—è MSK | –î–µ–π—Å—Ç–≤–∏–µ | –§–∞–π–ª—ã |
|-------------|-----------|----------|-------|
| **–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ** | 05:00 | üîÑ –ö–∞–Ω–∞–ª—ã + EPG | `tv_channel_full_dump.json`<br>`matching_results.json`<br>`iptv_full.db`<br>`epg/*.xml`<br>`playlists/*.m3u` |
| **–ü–Ω-–°–±** | 03:00 | üì∫ –¢–æ–ª—å–∫–æ EPG | `epg/*.xml`<br>`playlists/*.m3u` |

---

## üöÄ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

### –ß–µ—Ä–µ–∑ GitHub Actions UI

1. –ó–∞–π–¥–∏ –≤ **Actions** ‚Üí **IPTV Data Sync**
2. **Run workflow**
3. –í—ã–±–µ—Ä–∏ —Ç–∏–ø:
   - `epg_only` - —Ç–æ–ª—å–∫–æ EPG
   - `channels_only` - —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã
   - `full_sync` - –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –¢–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)
python output/dump_tv_channel.py
python full_pipeline.py
python output/production_fuzzy_matching.py

# –¢–æ–ª—å–∫–æ EPG (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
python scripts/download_epg.py
python scripts/process_epg.py
python scripts/generate_m3u_with_epg.py
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```bash
stats/
‚îú‚îÄ‚îÄ channels_latest.json         # –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º
‚îú‚îÄ‚îÄ channels_20251224_050000.json  # –ê—Ä—Ö–∏–≤
‚îú‚îÄ‚îÄ epg_latest.json              # –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ EPG
‚îî‚îÄ‚îÄ epg_20251224_030000.json     # –ê—Ä—Ö–∏–≤
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–π sync –∫–∞–Ω–∞–ª–æ–≤
cat stats/channels_latest.json | jq '.matching'

# –ü–æ—Å–ª–µ–¥–Ω–∏–π sync EPG
cat stats/epg_latest.json | jq '.sources'
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ secrets

–í GitHub Settings ‚Üí Secrets –¥–æ–±–∞–≤—å:

```
IPTVPORTAL_SESSION_ID = bbce5e5653cb4c0199e1e398cde99b16
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SESSION_ID:**
1. –ü–æ–ª—É—á–∏ –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä DevTools
2. –û–±–Ω–æ–≤–∏ secret –≤ GitHub
3. –ó–∞–ø—É—Å—Ç–∏ manual sync –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è issue:

**–ó–∞–≥–æ–ª–æ–≤–æ–∫:** `Sync failed - 2025-12-24T00:00:00Z`

**–¢–µ–ª–æ:** –°—Å—ã–ª–∫–∞ –Ω–∞ failed workflow run

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö–∞–Ω–∞–ª—ã (weekly)
- –î–∞–º–ø IPTVPortal: ~30 —Å–µ–∫
- –°–±–æ—Ä–∫–∞ iptv-org: ~5 –º–∏–Ω
- Fuzzy matching: ~20 –º–∏–Ω (difflib) / ~2 –º–∏–Ω (rapidfuzz)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ~10 —Å–µ–∫

**–ò—Ç–æ–≥–æ:** ~25-30 –º–∏–Ω—É—Ç

### EPG (daily)
- –ó–∞–≥—Ä—É–∑–∫–∞: ~2 –º–∏–Ω
- –û–±—Ä–∞–±–æ—Ç–∫–∞: ~1 –º–∏–Ω
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è M3U: ~30 —Å–µ–∫

**–ò—Ç–æ–≥–æ:** ~5 –º–∏–Ω—É—Ç

---

## üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è matching:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å rapidfuzz
uv pip install rapidfuzz

# –í production_fuzzy_matching.py –∑–∞–º–µ–Ω–∏—Ç—å:
from rapidfuzz import fuzz

def calculate_confidence(name1, name2):
    return fuzz.token_sort_ratio(name1, name2) / 100.0
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 10-15x faster (20 –º–∏–Ω ‚Üí 2 –º–∏–Ω)

---

## üìù Changelog

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ commit messages:

```
chore: weekly channel sync 2025-12-24
chore: daily EPG sync 2025-12-24
```

–ò—Å—Ç–æ—Ä–∏—è –≤ `git log --grep="sync"`

---

## üêõ Troubleshooting

### Session expired

```
Error: HTTP 401 Unauthorized
```

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏ `IPTVPORTAL_SESSION_ID` secret

### Matching —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π

```
Fuzzy matching: 30+ –º–∏–Ω—É—Ç
```

**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏ rapidfuzz (—Å–º. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

### EPG –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

```
Error: Failed to download EPG
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ `epg/sources.json`

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-12-24  
**–í–µ—Ä—Å–∏—è:** 1.0.0
